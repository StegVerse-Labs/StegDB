$schema: https://json-schema.org/draft/2020-12/schema
$id: https://stegverse-labs.github.io/stegdb/schemas/review_result_v1.json
title: StegDB Repo Review Result
description: >
  Validates a StegDB review output file (result.yml). This is a non-destructive report
  produced after analyzing a repository against a review request.

type: object
additionalProperties: false

required:
  - schema_name
  - schema_version
  - repo
  - summary

properties:
  schema_name:
    const: stegdb_repo_review_result
  schema_version:
    type: string
    const: 1.0.0

  repo:
    type: object
    additionalProperties: false
    required: [owner, name, default_branch, reviewed_at_utc]
    properties:
      owner: { type: string, minLength: 1 }
      name: { type: string, minLength: 1 }
      default_branch: { type: string, minLength: 1 }
      reviewed_at_utc:
        type: string
        description: ISO-8601 UTC timestamp (must end with 'Z')
        pattern: '^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}Z$'

  summary:
    type: object
    additionalProperties: false
    required: [confidence_signal, serious_failures_detected]
    properties:
      confidence_signal:
        type: string
        enum: [green, yellow, red]
      rationale:
        type: array
        items: { type: string }
        default: []
      serious_failures_detected:
        type: boolean

  inventory:
    type: object
    additionalProperties: false
    properties:
      file_counts:
        type: object
        additionalProperties: false
        properties:
          markdown: { type: integer, minimum: 0 }
          yaml: { type: integer, minimum: 0 }
          json: { type: integer, minimum: 0 }
          python: { type: integer, minimum: 0 }
          other: { type: integer, minimum: 0 }
      key_entrypoints_found:
        type: array
        items: { type: string }
        default: []
      missing_recommended:
        type: array
        items: { type: string }
        default: []

  legacy_register:
    type: object
    additionalProperties: false
    properties:
      candidates:
        type: array
        default: []
        items:
          type: object
          additionalProperties: false
          required: [path, label, reason, severity]
          properties:
            path: { type: string, minLength: 1 }
            label:
              type: string
              enum: [active, experimental, legacy, candidate_for_deprecation]
            reason: { type: string, minLength: 1 }
            severity:
              type: string
              enum: [low, moderate, serious]

  doc_alignment:
    type: object
    additionalProperties: false
    properties:
      overclaims:
        type: array
        items: { type: string }
        default: []
      gatekeeping_signals:
        type: array
        items: { type: string }
        default: []
      suggested_doc_changes:
        type: array
        default: []
        items:
          type: object
          additionalProperties: false
          required: [file, change, priority]
          properties:
            file: { type: string, minLength: 1 }
            change: { type: string, minLength: 1 }
            priority:
              type: string
              enum: [low, medium, high]

  first_contact:
    type: object
    additionalProperties: false
    properties:
      passes: { type: boolean }
      issues:
        type: array
        items: { type: string }
        default: []
      recommended_additions:
        type: array
        items: { type: string }
        default: []

  minimum_standard_v1:
    type: object
    additionalProperties: false
    required: [passes]
    properties:
      passes:
        type: boolean
        description: Whether the repo meets the minimum standard baseline.
      repo_type:
        type: string
        enum: [foundation, identity, template, tooling, research, experiment, archive, unknown]
      missing_required:
        type: array
        items: { type: string }
        default: []
      missing_recommended:
        type: array
        items: { type: string }
        default: []
      readme_coverage:
        type: object
        additionalProperties: false
        properties:
          what_this_is: { type: boolean }
          what_this_is_not: { type: boolean }
          current_status: { type: boolean }
          how_to_start: { type: boolean }
          how_it_connects: { type: boolean }
      status_md:
        type: object
        additionalProperties: false
        properties:
          present: { type: boolean }
          has_state: { type: boolean }
          has_works_today: { type: boolean }
          has_known_gaps: { type: boolean }
          has_next_steps: { type: boolean }
          has_last_reviewed_utc: { type: boolean }
      type_specific:
        type: object
        additionalProperties: true
      notes:
        type: array
        items: { type: string }
        default: []

  failure_modes:
    type: object
    additionalProperties: false
    properties:
      serious:
        type: array
        items: { type: string }
        default: []
      moderate:
        type: array
        items: { type: string }
        default: []
      low:
        type: array
        items: { type: string }
        default: []

  suggested_patches:
    type: object
    additionalProperties: false
    properties:
      available: { type: boolean }
      path: { type: string }
      notes:
        type: array
        items: { type: string }
        default: []
