name: stegdb-central

on:
  workflow_dispatch:
    inputs:
      repo:
        description: "Optional repo name (e.g. CosDen). Leave blank to run all."
        required: false
        default: ""

jobs:
  full-cycle:
    runs-on: ubuntu-latest

    permissions:
      contents: write

    steps:
      - name: Checkout StegDB
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Checkout CosDen (for now)
        uses: actions/checkout@v4
        with:
          repository: StegVerse-Labs/CosDen
          path: CosDen
          fetch-depth: 0

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install minimal deps
        run: |
          python -m pip install --upgrade pip

      - name: Run StegDB Full Cycle
        run: |
          if [ -n "${{ github.event.inputs.repo }}" ]; then
            python tools/run_full_cycle.py --repo "${{ github.event.inputs.repo }}"
          else
            python tools/run_full_cycle.py --all
          fi
