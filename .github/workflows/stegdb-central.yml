name: StegDB Central Full Cycle

on:
  # manual run from Actions tab
  workflow_dispatch:

  # automatic guardian runs (every 6 hours)
  schedule:
    - cron: '15 */6 * * *'

jobs:
  full-cycle:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout StegDB
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Run StegDB Full Cycle
        run: python tools/run_full_cycle.py

      - name: Upload StegDB metadata artifacts
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: stegdb-metadata
          path: |
            meta/aggregated_files.jsonl
            meta/dependency_status.json
          if-no-files-found: ignore

      - name: Print dependency summary (if present)
        if: always()
        run: |
          echo "===== StegDB Guardian Summary ====="
          if [ -f meta/dependency_status.json ]; then
            cat meta/dependency_status.json
          else
            echo "No meta/dependency_status.json produced."
          fi
